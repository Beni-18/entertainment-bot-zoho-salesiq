// ============================================
// EntertainmentBuddy - Main Bot Script
// Deluge for Zoho SalesIQ
// ============================================

on_chat_open()
{
    msg = map();
    msg.put("type", "text");
    msg.put("content", "Welcome to EntertainmentBuddy! ğŸ¬\nYour AI-powered entertainment companion");
    
    sendResponse(msg);
    showMainMenu();
}

on_user_message()
{
    user_input = message.get("text").toLowerCase();
    
    if(user_input.contains("suggest") || user_input.contains("recommendation"))
    {
        handleSuggestSomething();
    }
    else if(user_input.contains("book") || user_input.contains("event") || user_input.contains("ticket"))
    {
        handleBookEvent();
    }
    else if(user_input.contains("surprise") || user_input.contains("mood") || user_input.contains("plan"))
    {
        handleSurpriseMe();
    }
    else
    {
        showMainMenu();
    }
}

showMainMenu()
{
    options = list(
        map("text", "ğŸ“½ï¸ Suggest something", "value", "suggest"),
        map("text", "ğŸ« Book an event", "value", "book"),
        map("text", "ğŸ² Surprise me", "value", "surprise")
    );
    
    card = map();
    card.put("type", "suggestion");
    card.put("title", "What would you like to do?");
    card.put("options", options);
    
    sendResponse(card);
}

handleSuggestSomething()
{
    categories = list(
        map("text", "ğŸ¬ Movies", "value", "movies"),
        map("text", "ğŸ“š Books", "value", "books"),
        map("text", "ğŸ® Games", "value", "games"),
        map("text", "ğŸ” Food", "value", "food"),
        map("text", "ğŸµ Music", "value", "music")
    );
    
    card = map();
    card.put("type", "suggestion");
    card.put("title", "Choose a category:");
    card.put("options", categories);
    
    sendResponse(card);
}

handleBookEvent()
{
    event_types = list(
        map("text", "ğŸ¬ Movies", "value", "movies"),
        map("text", "ğŸ¤ Talkshows", "value", "talkshows"),
        map("text", "ğŸµ Concerts", "value", "concerts"),
        map("text", "ğŸ“ Find nearby", "value", "nearby")
    );
    
    card = map();
    card.put("type", "suggestion");
    card.put("title", "What would you like to book?");
    card.put("options", event_types);
    
    sendResponse(card);
}

handleSurpriseMe()
{
    moods = list(
        map("text", "ğŸ˜Œ Chill", "value", "chill"),
        map("text", "ğŸ¤© Excited", "value", "excited"),
        map("text", "ğŸ’• Romantic", "value", "romantic"),
        map("text", "âš¡ Energetic", "value", "energetic"),
        map("text", "ğŸ˜´ Bored", "value", "bored")
    );
    
    card = map();
    card.put("type", "suggestion");
    card.put("title", "What's your mood right now?");
    card.put("options", moods);
    
    sendResponse(card);
}

sendResponse(content)
{
    response = map();
    response.put("message", content);
    return response;
}
